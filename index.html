<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="jquery.timeago.js"></script>
    <link href="stylesheet.css" rel="stylesheet">
  </head>
  <body>
    <h1>Twittler</h1>
    <div id=feed></div>
    <div id=timeline></div>

    <script>

      $(document).ready(function(){
        var $body = $('body'); // captures entire body DOM element
        var $feed = $('#feed');
        jQuery("time.timeago").timeago();

        //var index = streams.home.length - 1; // last item in streams.home array
        var pullFromArray = function () {
          var tweet = streams.home.shift(); // captures last tweet
          var $span = $('<span></span>').addClass('line ' + tweet.user);
          var $tweet = $('<span></span><br>')
          .text(': ' + tweet.message); // adds tweet text to span
          var $user = $('<span></span>').text('@' + tweet.user)
            .addClass('userName '+ tweet.user); // makes a span for the username w/ class username
          var $date = $('<span></span>').text(jQuery.timeago(tweet.created_at));
          $date.appendTo($span);
          $user.appendTo($span);
          $tweet.appendTo($span); // adds new tweet span to the page
          if ($('#timeline').find('h2').text() === tweet.user) {
            $span.appendTo('#timeline');
          } else {
            $span.appendTo($feed);
          }
        };

        while(streams.home.length > 0){
          pullFromArray();
          //index -= 1;
        }

        var filtered = false;

        $('#feed').on('click','.userName', function() {
          if (!filtered) {
            var thisUser = '.'+$(this).attr('class').split(' ')[1];
            $('<h2></h2>').text(thisUser.slice(1)).appendTo('#timeline');
            $(this).parent().children().appendTo('#timeline');
            filtered = true;
          }
        });

        $('#timeline').on('click','span', function() {
          if (filtered) {
            var thisUser = '.'+$(this).attr('class').split(' ')[1];
            $('h2').remove();
            $('#timeline span').appendTo($feed);
            $('<br>').appendTo($feed);
            filtered = false;
          }
        });

        var pullFromStream = function () {
          if (streams.home.length > 0) {
            pullFromArray();
          }

          setTimeout(function(){pullFromStream();}, Math.random() * 3000);
        };

        pullFromStream();
      });
    </script>


  </body>
</html>
